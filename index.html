<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>socket</title>
    <script type="text/javascript" src="./socket.io.js"></script>
    <link rel="stylesheet" href="index.css"/>
</head>

<body>
<h1>ID:<input type="text" name="id" class="id" id="id"></h1>
<div id="board"></div>
<input type="text" name="msg" class="input" id="msg">
<input type="submit" id="sub" class="input">



<script type="text/javascript">
    var board = document.getElementById("board");
    var id = Math.random().toString(36).substr(18);
    var sub = document.getElementById("sub");
    document.getElementById('id').value = id;
    //console.log(id);
    var socket = io.connect('http://localhost:80');
    socket.userId = id;
    socket.on('welcome', function (data) {
        //欢迎别人加入聊天的代码
        let welcomeOther = document.createElement("p");
        welcomeOther.innerText = '欢迎' + data.id + '进入聊天室';
        welcomeOther.setAttribute('class','welcome');
        board.appendChild(welcomeOther);

    });
    socket.on('msg', function (data) {
        //别人说的话
        let message = document.createElement("p");
        message.innerHTML = '<p class="person">'+data.id+"   "+data.date+'</p><p class="message">'+data.msg+'</p>';
        board.appendChild(message);
        //console.log(data);
    });
    socket.on('dis', function (data) {
        //别人离开聊天室
        console.log(data);
        let dis = document.createElement("p");
        dis.innerText = data + '离开了聊天室';
        dis.setAttribute('class','welcome');
        board.appendChild(dis);
    });
    socket.on('news', function (data) {
        socket.emit('welcome',{id:id});
        //欢迎进入聊天室添加进聊天框的代码
        let welcome = document.createElement("p");
        welcome.innerText = '欢迎' + document.getElementById('id').value + '进入聊天室';
        welcome.setAttribute('class','welcome');
        board.appendChild(welcome);
        sub.onclick = function msg (){
            if(document.getElementById('id').value==''||document.getElementById('msg').value==''){
                alert('空值不可以发送');
            }else{
                let data = {};
                socket.userId = document.getElementById('id').value;
                data.id = document.getElementById('id').value;//id
                data.msg = document.getElementById('msg').value;//信息
                data.date = new Date().toLocaleString( );//时间
                socket.emit('msg',data);
                //自己发的消息添加进聊天框的代码
                let message = document.createElement("p");
                message.innerHTML = '<p class="person">'+data.id+"   "+data.date+'</p><p class="message">'+data.msg+'</p>';
                board.appendChild(message);
            }
        }
    });
    //socket.on('disconnect',{id:document.getElementById('id').value})
</script>

</body>
</html> 